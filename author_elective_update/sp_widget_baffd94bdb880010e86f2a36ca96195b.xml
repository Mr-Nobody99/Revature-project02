<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="DELETE">
        <category>kb</category>
        <client_script><![CDATA[function ($scope, $rootScope, $timeout, spKBCategoryService) {
	var accessWordCountMax = 15;
	var c = this;
	init();
	
	c.getShortenText = function getShortenText(text) {
		var wordsArray = text.split(" ");
		if (wordsArray.length > accessWordCountMax)
			wordsArray = wordsArray.slice(0, accessWordCountMax);
		return wordsArray.join(" ");
	}
	
	var removeListener = spKBCategoryService.addListener(function(catId) {
		c.data.category = catId;
		c.data.items = null;
		c.server.update().then(function(){
			init();
		});
	});
	
	function init() {
		$timeout(function() {
			$rootScope.$broadcast('sp.update.breadcrumbs', c.data.breadcrumbs);
		});
	}
	$scope.hideItemWidget = !$scope.data.category;
	$scope.showCategories =  function() {
		$scope.hideItemWidget = true;
		$rootScope.$broadcast("$sp.kb.show.categories_widget");
	}
	$scope.$on('$destroy', function(){
		removeListener();
	});
	
	$scope.loadMore = function () {
		c.data.new_limit = c.data.limit + (parseInt(c.options.limit_article) || 10);
		c.server.update();
	}
}]]></client_script>
        <controller_as>c</controller_as>
        <css>.btn-loadmore {
      margin-left: auto;
      margin-right: auto;
      display: block;
      margin-bottom: 20px;
    }
    
    .kb-star-on {
      color: $fav-star-color !important;
      text-shadow: $fav-star-outline;
    }

    .kb-star-off {
      color: $fav-star-color-off !important;
      text-shadow: $fav-star-outline;
    }</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list>color</field_list>
        <has_preview>true</has_preview>
        <id/>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>Copy of KB Category Page</name>
        <option_schema>[{"name":"show_star_rating","default_value":"Use system properties","section":"Presentation","label":"Show star rating","type":"choice","choices":[{"label":"Yes","value":"Yes"},{"label":"No","value":"No"},{"label":"Use system properties","value":"Use system properties"}]},{"hint":"Number of articles to display per page","name":"limit_article","section":"other","default_value":"10","label":"Number of articles to display per page","type":"integer"}]</option_schema>
        <public>true</public>
        <roles/>
        <script><![CDATA[(function(){
// populate the 'data' variable
if (input)
	data.category = input.category;
else
	data.category = $sp.getParameter("kb_category");

var kbIds = $sp.getKnowledgeBases();
var kbs = kbIds.split(',');

data.limit = parseInt(options.limit_article) || 10;

if (input && input.new_limit)
    data.limit = input.new_limit;

var kb_cat = new GlideRecord("kb_category");
data.categoryDisplay = gs.getMessage("Select a category");
data.items = [];
data.categoryExists = false;
if (kb_cat.get(data.category)) {
  data.categoryExists = true;
  data.categoryDisplay = kb_cat.getDisplayValue();
  data.items = $sp.getKBCategoryArticleSummaries(data.category, data.limit + 1 , 250);
}

var diff = data.items.length - data.limit;
if (diff <= 0)
    data.showMore = false; 
else {
	data.items.splice(data.limit);
	data.showMore = true;
}
data.show_msg = gs.getMessage("Showing {0} items", data.limit + "");

var kbId = $sp.getParameter('kb_id');

data.kbId=kbId;

if (kbId) {
	var gr = new GlideRecord("kb_knowledge_base");
	if (gr.get(kbId))
		data.kbName = gr.getDisplayValue("title");
}

data.kb_knowledge_page = $sp.getDisplayValue("kb_knowledge_page") || "kb_view";

data.breadcrumbs = [{label: data.categoryDisplay, url: '#'}];
/*var rec = kb_cat.parent_id.getRefRecord();
while (rec.getRecordClassName() == "kb_category") {
	if (kbId) 
		data.breadcrumbs.unshift({label: rec.getDisplayValue(), url: '?id=kb_category&kb_category=' + rec.getUniqueValue() + '&kb_id='+ kbId});
	else
		data.breadcrumbs.unshift({label: rec.getDisplayValue(), url: '?id=kb_category&kb_category=' + rec.getUniqueValue()});
  rec = rec.parent_id.getRefRecord();
}*/

if (kbs && kbs.length > 1){
	if (kbId)
		data.breadcrumbs.unshift({label: data.kbName, url: '?id=' + data.kb_knowledge_page + '&kb_id='+ kbId});

	data.breadcrumbs.unshift({label: gs.getMessage("All Knowledge Bases"), url: '?id=' + data.kb_knowledge_page});
}
else
	data.breadcrumbs.unshift({label: gs.getMessage("Knowledge Base"), url: '?id=' + data.kb_knowledge_page});


data.showStarRating = showStarRating();

function showStarRating() {
	if (options.show_star_rating == "Yes")
		return true;

	if (options.show_star_rating == "No")
		return false;

	// check gating property for all rating options
	if (gs.getProperty("glide.knowman.show_rating_options", "true") != "true")
		return false;

	// does user have the right role?
	if (!gs.hasRole(gs.getProperty("glide.knowman.show_rating_options.roles")))
		return false;

	// check specific property for stars
	if (gs.getProperty("glide.knowman.show_star_rating", "true") != "true")
		return false;
		
	// does user have the right role?
	return gs.hasRole(gs.getProperty("glide.knowman.show_star_rating.roles"));
}
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-09-27 01:39:34</sys_created_on>
        <sys_id>baffd94bdb880010e86f2a36ca96195b</sys_id>
        <sys_mod_count>3</sys_mod_count>
        <sys_name>Copy of KB Category Page</sys_name>
        <sys_package display_value="Project2" source="x_393226_project2">bb4a5b6fdb737300e86f2a36ca9619b2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Project2">bb4a5b6fdb737300e86f2a36ca9619b2</sys_scope>
        <sys_update_name>sp_widget_baffd94bdb880010e86f2a36ca96195b</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-09-27 01:49:14</sys_updated_on>
        <template><![CDATA[<div ng-class="{'hidden-xs' : hideItemWidget}">
  <a ng-click="showCategories()" class="visible-xs m-b-sm pointer" aria-label="${All Categories}">
     <i class="fa fa-chevron-left m-r-xs"></i> ${All Categories}
  </a>
  <div class="panel panel-{{::options.color}} b">
    <div class="panel-heading">
      <h2 class="panel-title">{{data.categoryDisplay}}</h2>
    </div>

    <div role="list" class="panel-body">
      <div ng-if="data.items.length == 0">
        (${No articles})
      </div>
      <div role="listitem" ng-repeat="kb_article in data.items" class="sp-kb-topic-article m-b-lg">
          <a ng-href="?id=kb_article&sys_id={{::kb_article.sys_id}}">{{::kb_article.title}}</a>
        <div style="max-height: 3em; overflow: hidden; padding-top:4px;" aria-label="{{::c.getShortenText(kb_article.text)}}">{{::kb_article.text}}</div>
        <div class="kb-about" style="padding-top:4px;">
          <span class="about-outer-span">
            <span class="author pad-right" ng-if="kb_article.author">
              <glyph sn-char="user" class="pad-right" aria-hidden="true"/>
              ${Authored by {{::kb_article.author}}}
            </span>
            <span ng-if="kb_article.sys_view_count == 1" class="views pad-right">
              <span class="pad-right">&#8226;</span> <glyph sn-char="eye-open" class="pad-right" />
              ${{{::kb_article.sys_view_count}} View}
            </span>
            <span ng-if="kb_article.sys_view_count > 1" class="views pad-right">
              <span class="pad-right">&#8226;</span> <glyph sn-char="eye-open" class="pad-right" />
              ${{{::kb_article.sys_view_count}} Views}
            </span>
            <span class="published pad-right">
              <span class="pad-right" aria-hidden="true">&#8226;</span> <glyph sn-char="calendar" class="pad-right" aria-hidden="true" />
              <sn-day-ago date="kb_article.published"/>
            </span>
            <span ng-if="data.showStarRating && kb_article.rating">
              <span class="pad-right">&#8226;</span>
              <span class="sr-only">Article rating - {{::kb_article.rating}}</span>
              <uib-rating sp-rating ng-model="::kb_article.rating" max="5" readonly="true" aria-hidden="true" state-on="'fa fa-star kb-star-on'" state-off="'fa fa-star kb-star-off'" />
            </span>
          </span>
        </div>
      </div>
    </div>

  </div>
  <div ng-if="data.showMore">
    <div class="text-a-c">
       {{data.show_msg}}
    </div>
    <button class="m-t-xs btn btn-default btn-loadmore" ng-click="loadMore()">
        ${Show More}
    </button>
  </div>
</div>]]></template>
    </sp_widget>
    <sys_update_version action="INSERT_OR_UPDATE">
        <action>DELETE</action>
        <application display_value="Project2">bb4a5b6fdb737300e86f2a36ca9619b2</application>
        <file_path/>
        <instance_id>3cce5ae0dbc577c03050ac44d49619c1</instance_id>
        <instance_name>dev82960</instance_name>
        <name>sp_widget_baffd94bdb880010e86f2a36ca96195b</name>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sp_widget"&gt;&lt;sp_widget action="INSERT_OR_UPDATE"&gt;&lt;category&gt;kb&lt;/category&gt;&lt;client_script&gt;&lt;![CDATA[function ($scope, $rootScope, $timeout, spKBCategoryService) {
	var accessWordCountMax = 15;
	var c = this;
	init();
	
	c.getShortenText = function getShortenText(text) {
		var wordsArray = text.split(" ");
		if (wordsArray.length &gt; accessWordCountMax)
			wordsArray = wordsArray.slice(0, accessWordCountMax);
		return wordsArray.join(" ");
	}
	
	var removeListener = spKBCategoryService.addListener(function(catId) {
		c.data.category = catId;
		c.data.items = null;
		c.server.update().then(function(){
			init();
		});
	});
	
	function init() {
		$timeout(function() {
			$rootScope.$broadcast('sp.update.breadcrumbs', c.data.breadcrumbs);
		});
	}
	$scope.hideItemWidget = !$scope.data.category;
	$scope.showCategories =  function() {
		$scope.hideItemWidget = true;
		$rootScope.$broadcast("$sp.kb.show.categories_widget");
	}
	$scope.$on('$destroy', function(){
		removeListener();
	});
	
	$scope.loadMore = function () {
		c.data.new_limit = c.data.limit + (parseInt(c.options.limit_article) || 10);
		c.server.update();
	}
}]]&gt;&lt;/client_script&gt;&lt;controller_as&gt;c&lt;/controller_as&gt;&lt;css&gt;.btn-loadmore {
      margin-left: auto;
      margin-right: auto;
      display: block;
      margin-bottom: 20px;
    }
    
    .kb-star-on {
      color: $fav-star-color !important;
      text-shadow: $fav-star-outline;
    }

    .kb-star-off {
      color: $fav-star-color-off !important;
      text-shadow: $fav-star-outline;
    }&lt;/css&gt;&lt;data_table&gt;sp_instance&lt;/data_table&gt;&lt;demo_data/&gt;&lt;description/&gt;&lt;docs/&gt;&lt;field_list&gt;color&lt;/field_list&gt;&lt;has_preview&gt;true&lt;/has_preview&gt;&lt;id/&gt;&lt;internal&gt;false&lt;/internal&gt;&lt;link&gt;&lt;![CDATA[function link(scope, element, attrs, controller) {  }]]&gt;&lt;/link&gt;&lt;name&gt;Copy of KB Category Page&lt;/name&gt;&lt;option_schema&gt;[{"name":"show_star_rating","default_value":"Use system properties","section":"Presentation","label":"Show star rating","type":"choice","choices":[{"label":"Yes","value":"Yes"},{"label":"No","value":"No"},{"label":"Use system properties","value":"Use system properties"}]},{"hint":"Number of articles to display per page","name":"limit_article","section":"other","default_value":"10","label":"Number of articles to display per page","type":"integer"}]&lt;/option_schema&gt;&lt;public&gt;true&lt;/public&gt;&lt;roles/&gt;&lt;script&gt;&lt;![CDATA[(function(){
// populate the 'data' variable
if (input)
	data.category = input.category;
else
	data.category = $sp.getParameter("kb_category");

var kbIds = $sp.getKnowledgeBases();
var kbs = kbIds.split(',');

data.limit = parseInt(options.limit_article) || 10;

if (input &amp;&amp; input.new_limit)
    data.limit = input.new_limit;

var kb_cat = new GlideRecord("kb_category");
data.categoryDisplay = gs.getMessage("Select a category");
data.items = [];
data.categoryExists = false;
if (kb_cat.get(data.category)) {
  data.categoryExists = true;
  data.categoryDisplay = kb_cat.getDisplayValue();
  data.items = $sp.getKBCategoryArticleSummaries(data.category, data.limit + 1 , 250);
}

var diff = data.items.length - data.limit;
if (diff &lt;= 0)
    data.showMore = false; 
else {
	data.items.splice(data.limit);
	data.showMore = true;
}
data.show_msg = gs.getMessage("Showing {0} items", data.limit + "");

var kbId = $sp.getParameter('kb_id');

data.kbId=kbId;

if (kbId) {
	var gr = new GlideRecord("kb_knowledge_base");
	if (gr.get(kbId))
		data.kbName = gr.getDisplayValue("title");
}

data.kb_knowledge_page = $sp.getDisplayValue("kb_knowledge_page") || "kb_view";

data.breadcrumbs = [{label: data.categoryDisplay, url: '#'}];
/*var rec = kb_cat.parent_id.getRefRecord();
while (rec.getRecordClassName() == "kb_category") {
	if (kbId) 
		data.breadcrumbs.unshift({label: rec.getDisplayValue(), url: '?id=kb_category&amp;kb_category=' + rec.getUniqueValue() + '&amp;kb_id='+ kbId});
	else
		data.breadcrumbs.unshift({label: rec.getDisplayValue(), url: '?id=kb_category&amp;kb_category=' + rec.getUniqueValue()});
  rec = rec.parent_id.getRefRecord();
}*/

if (kbs &amp;&amp; kbs.length &gt; 1){
	if (kbId)
		data.breadcrumbs.unshift({label: data.kbName, url: '?id=' + data.kb_knowledge_page + '&amp;kb_id='+ kbId});

	data.breadcrumbs.unshift({label: gs.getMessage("All Knowledge Bases"), url: '?id=' + data.kb_knowledge_page});
}
else
	data.breadcrumbs.unshift({label: gs.getMessage("Knowledge Base"), url: '?id=' + data.kb_knowledge_page});


data.showStarRating = showStarRating();

function showStarRating() {
	if (options.show_star_rating == "Yes")
		return true;

	if (options.show_star_rating == "No")
		return false;

	// check gating property for all rating options
	if (gs.getProperty("glide.knowman.show_rating_options", "true") != "true")
		return false;

	// does user have the right role?
	if (!gs.hasRole(gs.getProperty("glide.knowman.show_rating_options.roles")))
		return false;

	// check specific property for stars
	if (gs.getProperty("glide.knowman.show_star_rating", "true") != "true")
		return false;
		
	// does user have the right role?
	return gs.hasRole(gs.getProperty("glide.knowman.show_star_rating.roles"));
}
})();]]&gt;&lt;/script&gt;&lt;servicenow&gt;false&lt;/servicenow&gt;&lt;sys_class_name&gt;sp_widget&lt;/sys_class_name&gt;&lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2019-09-27 01:39:34&lt;/sys_created_on&gt;&lt;sys_id&gt;baffd94bdb880010e86f2a36ca96195b&lt;/sys_id&gt;&lt;sys_mod_count&gt;3&lt;/sys_mod_count&gt;&lt;sys_name&gt;Copy of KB Category Page&lt;/sys_name&gt;&lt;sys_package display_value="Project2" source="x_393226_project2"&gt;bb4a5b6fdb737300e86f2a36ca9619b2&lt;/sys_package&gt;&lt;sys_policy/&gt;&lt;sys_scope display_value="Project2"&gt;bb4a5b6fdb737300e86f2a36ca9619b2&lt;/sys_scope&gt;&lt;sys_update_name&gt;sp_widget_baffd94bdb880010e86f2a36ca96195b&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2019-09-27 01:49:14&lt;/sys_updated_on&gt;&lt;template&gt;&lt;![CDATA[&lt;div ng-class="{'hidden-xs' : hideItemWidget}"&gt;
  &lt;a ng-click="showCategories()" class="visible-xs m-b-sm pointer" aria-label="${All Categories}"&gt;
     &lt;i class="fa fa-chevron-left m-r-xs"&gt;&lt;/i&gt; ${All Categories}
  &lt;/a&gt;
  &lt;div class="panel panel-{{::options.color}} b"&gt;
    &lt;div class="panel-heading"&gt;
      &lt;h2 class="panel-title"&gt;{{data.categoryDisplay}}&lt;/h2&gt;
    &lt;/div&gt;

    &lt;div role="list" class="panel-body"&gt;
      &lt;div ng-if="data.items.length == 0"&gt;
        (${No articles})
      &lt;/div&gt;
      &lt;div role="listitem" ng-repeat="kb_article in data.items" class="sp-kb-topic-article m-b-lg"&gt;
          &lt;a ng-href="?id=kb_article&amp;sys_id={{::kb_article.sys_id}}"&gt;{{::kb_article.title}}&lt;/a&gt;
        &lt;div style="max-height: 3em; overflow: hidden; padding-top:4px;" aria-label="{{::c.getShortenText(kb_article.text)}}"&gt;{{::kb_article.text}}&lt;/div&gt;
        &lt;div class="kb-about" style="padding-top:4px;"&gt;
          &lt;span class="about-outer-span"&gt;
            &lt;span class="author pad-right" ng-if="kb_article.author"&gt;
              &lt;glyph sn-char="user" class="pad-right" aria-hidden="true"/&gt;
              ${Authored by {{::kb_article.author}}}
            &lt;/span&gt;
            &lt;span ng-if="kb_article.sys_view_count == 1" class="views pad-right"&gt;
              &lt;span class="pad-right"&gt;&amp;#8226;&lt;/span&gt; &lt;glyph sn-char="eye-open" class="pad-right" /&gt;
              ${{{::kb_article.sys_view_count}} View}
            &lt;/span&gt;
            &lt;span ng-if="kb_article.sys_view_count &gt; 1" class="views pad-right"&gt;
              &lt;span class="pad-right"&gt;&amp;#8226;&lt;/span&gt; &lt;glyph sn-char="eye-open" class="pad-right" /&gt;
              ${{{::kb_article.sys_view_count}} Views}
            &lt;/span&gt;
            &lt;span class="published pad-right"&gt;
              &lt;span class="pad-right" aria-hidden="true"&gt;&amp;#8226;&lt;/span&gt; &lt;glyph sn-char="calendar" class="pad-right" aria-hidden="true" /&gt;
              &lt;sn-day-ago date="kb_article.published"/&gt;
            &lt;/span&gt;
            &lt;span ng-if="data.showStarRating &amp;&amp; kb_article.rating"&gt;
              &lt;span class="pad-right"&gt;&amp;#8226;&lt;/span&gt;
              &lt;span class="sr-only"&gt;Article rating - {{::kb_article.rating}}&lt;/span&gt;
              &lt;uib-rating sp-rating ng-model="::kb_article.rating" max="5" readonly="true" aria-hidden="true" state-on="'fa fa-star kb-star-on'" state-off="'fa fa-star kb-star-off'" /&gt;
            &lt;/span&gt;
          &lt;/span&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div ng-if="data.showMore"&gt;
    &lt;div class="text-a-c"&gt;
       {{data.show_msg}}
    &lt;/div&gt;
    &lt;button class="m-t-xs btn btn-default btn-loadmore" ng-click="loadMore()"&gt;
        ${Show More}
    &lt;/button&gt;
  &lt;/div&gt;
&lt;/div&gt;]]&gt;&lt;/template&gt;&lt;/sp_widget&gt;&lt;/record_update&gt;</payload>
        <payload_hash>1669730161</payload_hash>
        <record_name>Copy of KB Category Page</record_name>
        <reverted_from/>
        <source>396a0d03db480010e86f2a36ca96199d</source>
        <source_table>sys_update_set</source_table>
        <state>previous</state>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-09-27 01:49:14</sys_created_on>
        <sys_id>9432e1cbdb880010e86f2a36ca961902</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_recorded_at>16d70686cc10000001</sys_recorded_at>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-09-27 01:49:14</sys_updated_on>
        <type>Widget</type>
        <update_guid>dc32e1cb7a8800103116aa307e23b201</update_guid>
        <update_guid_history>dc32e1cb7a8800103116aa307e23b201:1669730161,fca1a5cb2988001051ffae8ba3cb45c0:765860459,c971658b91880010a24f1c26b98eab72:1334676302,3eff118b2f8800109c7d238aed576b5d:1660886450</update_guid_history>
    </sys_update_version>
    <sys_metadata_delete action="INSERT_OR_UPDATE">
        <sys_audit_delete display_value="Copy of KB Category Page">15a56b0bdb404010e86f2a36ca9619bd</sys_audit_delete>
        <sys_class_name>sys_metadata_delete</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-09-27 11:23:34</sys_created_on>
        <sys_db_object display_value="" name="sp_widget">sp_widget</sys_db_object>
        <sys_id>8c0019b3014f45839ccadd57fe418629</sys_id>
        <sys_metadata>baffd94bdb880010e86f2a36ca96195b</sys_metadata>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Copy of KB Category Page</sys_name>
        <sys_package display_value="Project2" source="x_393226_project2">bb4a5b6fdb737300e86f2a36ca9619b2</sys_package>
        <sys_parent/>
        <sys_policy/>
        <sys_scope display_value="Project2">bb4a5b6fdb737300e86f2a36ca9619b2</sys_scope>
        <sys_scope_delete display_value="">7b2dd6acb1604e11adaecc154cd04419</sys_scope_delete>
        <sys_update_name>sp_widget_baffd94bdb880010e86f2a36ca96195b</sys_update_name>
        <sys_update_version display_value="sp_widget_baffd94bdb880010e86f2a36ca96195b">9432e1cbdb880010e86f2a36ca961902</sys_update_version>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-09-27 11:23:34</sys_updated_on>
    </sys_metadata_delete>
</record_update>
